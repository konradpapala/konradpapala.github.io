<!DOCTYPE html>
<html>
    <head>
        <title>Yalog demo</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel = "stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.css">
		<link rel = "stylesheet" href = "../assets/milligram/milligram.min.css">
		
		<!-- DON'T use this link, download the file instead --> 
		<script src = '../../yalog/src/yalog.js'></script>
		<script src = 'https://rawgit.com/kpion/yalog/master/src/yalog.js'></script>
		<script src = 'https://rawgit.com/kpion/yalog/master/src/plugins/page.js'></script>
		
		<script src = '../assets/ace/ace.js'></script>
		<style>
			
			body {
			  
				
			}		
			
			.content{
				margin: 0 auto;
				max-width: 60em;
				/*margin-bottom:150px;*/
			}
			
			/* ace edit element */
			#demoScriptEdit{
				width:90%;
				height:400px;
			}

			#story{
				height:200px;
			}

			
			.hidden{
				display:none;
			}

			/* -------------------------------------------- */        
	
		</style>		
    </head>
    <body>
		<div class = 'content'>
			<h1>Yalog demo</h1>
			<h2>In progress...</h2>
			<p>See developer tools -> console</p>
			<p>Github src: <a href = 'https://github.com/kpion/yalog'>https://github.com/kpion/yalog</a><p>

			<!-- editable js code -->

			<h2>Code:</h2>
			<div id = 'demoScriptEdit'></div>
			<br>
			<button id = 'runDemoScript'>Run it again</button>
			<br>
			
			<!-- page plugin -->

			<button id = 'enablePagePlugin' >Enable "page" (DOM) plugin</button>
			<div class = 'hidden' id = 'pagePluginCodeWrapper'>
				<textarea class = 'readonlyCode' data-ace-config = '{"mode":"ace/mode/html"}'>
					<!--adding this -->
					<script src = 'yalog/plugins/page.js'></script>
					<script>
						yalog.addPlugin(yalogPage);//optional logging on website	
					</script>
				</textarea>
			</div>
			<br>

			<!-- log history -->

			<button id = 'showStory' title = 'Which can be later sent... somewhere' >Show logged logs</button>
			<textarea id = 'story' class = 'hidden'></textarea>
			<br>

			<!-- husky! -->
			<button id = 'showRandomHusky'>Random husky!</button>
			<br>
		</div>
		
		<footer></footer>
		


		<script>
			//TESTING
			
			/*window.onerror = function(message, url, linenumber) {
				console.log("catched JavaScript error: " + message + " on line " + 
				linenumber + " for " + url);
			};*/
			//seems to work, js errors, not a result of console.error('adf'); but cought by browser. 
			/*
			window.addEventListener('error', (event) => {
				console.error("JavaScript error: " + event.message + " on line " + 
				event.lineno + " for " + event.filename);
				return false;
			});*/
		</script>
		<script>
			
			//not really related to the yalog itself.
			
			let baseUrl = window.location.href;
			if(baseUrl.slice(-1) !== '/'){
				baseUrl += '/';
			}
		</script>
		
		<script id = 'demoScript'>
			
			
			//creating a new selector (class), for displaying "banners". Just playing here... 
			yalog.cssSelector('banner',`
				
				padding:8px 15px;
				line-height: 40px;
				background-color:#034F84;
				border-radius: 5px;
				font-size:120%;
				color:white;
				font-weight:bold`);

			yalog.css('banner').log("Ya Log");
			yalog.log('Normal').
				style({'font-size': '130%'}).log('big').
				style('color:blue').log('... and blue');
			//predefined "selectors" (classes):
			yalog.css('h1').log('h1 selector');
			yalog.css('h2').log('h2 selector');
			yalog.css('h3').log('h3 selector');			
			yalog.css('indent').log('indented').css('indent').log('indented 2');
			
			//going back to normal
			yalog.setStyle({'color': '#000'});
			yalog.log('Color permanently changed to %100 black');
			
			yalog.css('h1').group('a group');
			yalog.log('Inside group');
			yalog.groupEnd();			
			
			
			/////////////////////
			//cloning tests for the purpose of another module
			
			yalog.css('banner').
				style('background-color:#DC4C46').
				log("Cloning tests (with a delayed output on the clone)");
			
			//this is another big module/class/whatever.
			function fakingSomeOtherModuleBeingLate(yalog = null){
				setTimeout(()=>{
					yalog.style('color:#DC4C46').
						log("I'm a different module, and late to the party, but it should be clear who I am");
					evenAnotherModule(yalog.clone('AnotherYetModule'));
				},1000);
				function evenAnotherModule(yalog = null){
					yalog.style('color:#034F84').log("I have a name too");
				}
			}
			
			//this clone and all its subclones will be indented and with "italics".
			let clone = yalog.css('indent i').clone("Laggard Module",{outputName:true});
			fakingSomeOtherModuleBeingLate(clone);

		</script>
		<script>
			
			
			//not really related to the yalog itself. Just this site's stuff.
			(function(){

				let sel = (s) => document.querySelector(s);
				let selAll = (s) => document.querySelectorAll(s);

				
				//ace editor for all .readonlyCode elements
				selAll('.readonlyCode').forEach(el => {
					let config = el.getAttribute('data-ace-config');
					config = config?JSON.parse(config):{};
					el.value = el.value.replace(/^\t\t\t/g,'');
					let aceEditor = ace.edit(el,{
						autoScrollEditorIntoView: true,
						maxLines: 80,
						showPrintMargin: false,
						highlightActiveLine: false,
						readOnly:true,
					});	
					aceEditor.session.setUseWorker(false);//hmmm a trick to disable the syntax checker.
					aceEditor.session.setMode(config.mode?config.mode:"ace/mode/javascript");		
				})
					
				//ace editor for demo script
				var editor = ace.edit("demoScriptEdit",{
					autoScrollEditorIntoView: true,
					maxLines: 80,
					showPrintMargin: false,
					highlightActiveLine: false,
					
				});
				
				//editor.setTheme("ace/theme/twilight");
				editor.session.setMode("ace/mode/javascript");				
				
				//editor and "run again":

				//getting our real <script>...<script> code:
				let script = sel('#demoScript').textContent.trim();
				script = script.replace(/\t\t\t/g,'');
				editor.setValue(script);
				editor.clearSelection();//otherwise it selects all o.O 
				
				//run it again:
				sel('#runDemoScript').addEventListener('click',()=>{
					let displayScript = editor.getValue();
					eval(displayScript);
				});			   
				
				//add 'page' plugin button
				sel('#enablePagePlugin').addEventListener('click',()=>{
					sel('#pagePluginCodeWrapper').classList.remove('hidden');
					setTimeout(()=>{yalog.addPlugin(yalogPage);},100);
				})
				
				 
				//show all the output as jsoned array.
				sel('#showStory').addEventListener('click',() => {
					let storyEl = sel ('#story');
					storyEl.classList.toggle('hidden');
					
					if(!storyEl.classList.contains('hidden')){
						let story = yalog.JSONStringify(yalog.story(), null, '  ');
						storyEl.textContent = story;
					}
				});					
				
				sel('#showRandomHusky').addEventListener('click',() => {
					yalog.css('h2').log('Here you go, a random husky!');
					let rand = Math.round(Math.random() * 10);//only 10 huskies there.
					yalog.style(`
						background: url("${baseUrl}assets/images/huskies/husky-${rand}.jpg") no-repeat;
						padding: 140px 180px;
			
					`).log('');
			
				});
			})();
			
		</script>
    </body>
</html>
